<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>

	<body>
		<canvas id="canvas" width="240" height="240" style="border: 1px solid red;background:url('烤箱.jpg')"></canvas>

	</body>

</html>

<script type="text/javascript">
	var canvas = document.querySelector('canvas');
	var ctx = canvas.getContext('2d');

	ctx.fillStyle = '#eee';
	ctx.fillRect(0, 0, canvas.width, canvas.height);

	ctx.globalCompositeOperation = 'destination-out';

	canvas.onmousedown = function() {
		this.onmousemove = function(e) {
			var x = e.pageX - canvas.offsetLeft;
			var y = e.pageY - canvas.offsetTop;

			ctx.beginPath();
			ctx.arc(x, y, 20, 0, 2 * Math.PI);
			ctx.fill();

			var data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
			console.log(data);
			
			var count = 0;
			for(i = 0; i < data.length; i += 4) {
				data[i] == 0 && data[i + 1] == 0 && data[i + 2] == 0 && data[i + 3] == 0 && count++;
			}
			
			count >= canvas.width * canvas.height / 2 && (ctx.fillRect(0,0,canvas.width,canvas.height));
		}
		this.onmouseout = function() {
			canvas.onmousemove = null;
		}
	}

	canvas.onmouseup = function() {
		this.onmousemove = null;
	}
</script>