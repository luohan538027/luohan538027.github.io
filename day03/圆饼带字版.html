<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>

	<body>
		<canvas id="canvas" width="800" height="800" style="border: 1px solid red;"></canvas>
	</body>

</html>

<script type="text/javascript">
	var canvas = document.querySelector('#canvas');
	var Pie = (function() {
		var colors = (function() {
			return("aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue," +
				"blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk," +
				"crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta," +
				"darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray," +
				"darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick," +
				"floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey," +
				"honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon," +
				"lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink," +
				"lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow," +
				"lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple," +
				"mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue," +
				"mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid," +
				"palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue," +
				"purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna," +
				"silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,transparent," +
				"tomato,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen").split(',');
		})();

		function Pie(opt) {
			for(var key in opt) {
				this[key] = opt[key];
			}

			this.ctx = this.canvas.getContext('2d');
			this.init();
		}

		Pie.prototype = {
			constructor: Pie,

			init: function() {
				this.getSum();
				this.getData();
				this.getPosition();
				this.drawPie();
				this.drawText();
			},

			//获得数据各项总和
			getSum: function() {
				var sum = 0;
				this.data.forEach(function(v) {
					sum += v;
				})
				this.sum = sum;
			},

			//获得数据中的rate 和 弧度差值
			getData: function() {
				this.data2 = this.data.map(function(v) {
					var rate = v / this.sum;
					var radian = 2 * Math.PI * rate;
					return {
						data: v,
						rate: rate,
						radian: radian
					}
				}, this)
			},

			//根据数据中的rate 和 弧度差 确定每个部分的起始和结束弧度值
			getPosition: function() {
				var begin = this.begin;
				this.data3 = this.data2.map(function(v, i) {
					start = begin;
					var end = start + v.radian;
					begin = end;
					return {
						data:v.data,
						radian:v.radian,
						start: start,
						end: end
					}

				})
			},

			//绘制圆饼开始
			drawPie: function() {
				var ctx = this.ctx;
				this.data3.forEach(function(v, i) {
					ctx.beginPath();
					ctx.moveTo(this.x, this.y);
					ctx.arc(this.x, this.y, this.radius, v.start, v.end);
					ctx.fillStyle = colors[i + 15];
					ctx.fill();

				}, this);
			},
			
			//写文字
			drawText:function() {
				this.data3.forEach(function(v){
					//文字所在点弧度制
					var text = v.start + v.radian / 2;
					var textX = (this.radius + 20) * Math.cos(text);
					var textY = (this.radius +20) * Math.sin(text);
					
					var ctx = this.ctx;
					ctx.beginPath();
					ctx.font = '20px 微软雅黑';
					ctx.fillStyle = 'black';
//					ctx.textBaseline = 'bottom';
					ctx.fillText(v.data,textX + this.x ,textY + this.y);
					
				},this)
				
			}

		}
		return Pie;
	})();

	var pie = new Pie({
		x: 300,
		y: 300,
		radius: 150,
		data: [1, 2, 3, 4, 5, 6, 7, 8, 9],
		canvas: canvas,
		begin: -Math.PI / 2
	});
</script>